<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Countdown Timers</title>
        <style>
            html,
            body {
                margin: 0;
                padding: 0;
                height: 100%;
                width: 100%;
                font-family: sans-serif;
                background: #f0f0f0;
            }

            /* Container for initial buttons */
            .button-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                height: 100vh;
                justify-content: center;
            }

            .custom-timers {
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                margin: 20px;
            }

            .custom-timers button.start-timer {
                margin: 10px;
                padding: 20px 40px;
                font-size: 1.5rem;
                cursor: pointer;
                position: relative;
            }

            .custom-timers {
                align-items: center;
            }

            .custom-timer-item {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .custom-timer-item button.remove-timer {
                font-size: 1.2rem;
                cursor: pointer;
                border: none;
                background: transparent;
                color: red;
                font-weight: bold;
            }

            .add-timer-form {
                display: flex;
                margin-top: 20px;
            }

            .add-timer-form input {
                padding: 10px;
                font-size: 1rem;
                margin-right: 10px;
                width: 100px;
                text-align: center;
            }

            .add-timer-form button {
                padding: 10px 20px;
                font-size: 1rem;
                cursor: pointer;
            }

            /* Fullscreen countdown display */
            .countdown-display {
                display: none;
                justify-content: center;
                align-items: center;
                background: #000;
                color: #fff;
                font-size: 15vw;
                font-weight: bold;
                height: 100vh;
                width: 100vw;
                text-align: center;
                position: relative;
            }

            /* Flash animation when done */
            @keyframes flash {
                0% {
                    background: #000;
                    color: #fff;
                }
                50% {
                    background: #fff;
                    color: #000;
                }
                100% {
                    background: #000;
                    color: #fff;
                }
            }

            .flash {
                animation: flash 0.5s alternate infinite;
            }

            /* Cancel (X) button */
            .cancel-btn {
                position: absolute;
                top: 10px;
                left: 10px;
                font-size: 3rem;
                font-weight: bold;
                color: #fff;
                background: transparent;
                border: none;
                cursor: pointer;
                display: none;
            }
        </style>
    </head>
    <body>
        <div class="button-container">
            <div class="custom-timers"></div>

            <form class="add-timer-form">
                <input
                    type="number"
                    min="1"
                    name="timer-seconds"
                    placeholder="Seconds"
                    required
                />
                <button type="submit">Add Timer</button>
            </form>
        </div>

        <div class="countdown-display">
            <button class="cancel-btn">x</button>
            <div class="time-text"></div>
        </div>

        <script>
            const customTimersContainer =
                document.querySelector(".custom-timers");
            const display = document.querySelector(".countdown-display");
            const timeText = document.querySelector(".time-text");
            const buttonContainer = document.querySelector(".button-container");
            const cancelBtn = document.querySelector(".cancel-btn");
            const addTimerForm = document.querySelector(".add-timer-form");
            const timerInput = addTimerForm.querySelector(
                'input[name="timer-seconds"]'
            );

            let intervalId = null;
            let customTimers = [];

            // Load custom timers from localStorage
            function loadCustomTimers() {
                const stored = localStorage.getItem("customTimers");
                customTimers = stored ? JSON.parse(stored) : [];
                renderCustomTimers();
            }

            function saveCustomTimers() {
                localStorage.setItem(
                    "customTimers",
                    JSON.stringify(customTimers)
                );
            }

            function renderCustomTimers() {
                // Clear current displayed custom timers
                customTimersContainer.innerHTML = "";
                customTimers.forEach((seconds, index) => {
                    const itemDiv = document.createElement("div");
                    itemDiv.classList.add("custom-timer-item");

                    const startBtn = document.createElement("button");
                    startBtn.classList.add("start-timer");
                    startBtn.setAttribute("data-seconds", seconds);
                    startBtn.textContent = formatTimeNatural(seconds);

                    const removeBtn = document.createElement("button");
                    removeBtn.classList.add("remove-timer");
                    removeBtn.textContent = "x";

                    removeBtn.addEventListener("click", () => {
                        removeCustomTimer(index);
                    });

                    startBtn.addEventListener("click", () => {
                        startCountdown(seconds);
                    });

                    itemDiv.appendChild(startBtn);
                    itemDiv.appendChild(removeBtn);
                    customTimersContainer.appendChild(itemDiv);
                });
            }

            function removeCustomTimer(index) {
                customTimers.splice(index, 1);
                saveCustomTimers();
                renderCustomTimers();
            }

            addTimerForm.addEventListener("submit", (e) => {
                e.preventDefault();
                const val = parseInt(timerInput.value, 10);
                if (val > 0) {
                    customTimers.push(val);
                    saveCustomTimers();
                    renderCustomTimers();
                    timerInput.value = "";
                }
            });

            cancelBtn.addEventListener("click", cancelCountdown);

            function startCountdown(timeLeft) {
                // Hide buttons, show display and cancel button
                buttonContainer.style.display = "none";
                display.style.display = "flex";
                cancelBtn.style.display = "block";
                timeText.textContent = formatTime(timeLeft);

                intervalId = setInterval(() => {
                    timeLeft--;
                    timeText.textContent = formatTime(timeLeft);
                    if (timeLeft <= 0) {
                        clearInterval(intervalId);
                        countdownFinished();
                    }
                }, 1000);
            }

            function countdownFinished() {
                display.classList.add("flash");
                timeText.textContent = "0:00";
                // After 5 seconds of flashing, stop flashing and reset
                setTimeout(() => {
                    resetUI();
                }, 5000);
            }

            function cancelCountdown() {
                // If an interval is running, clear it
                if (intervalId) {
                    clearInterval(intervalId);
                }
                resetUI();
            }

            function resetUI() {
                display.classList.remove("flash");
                display.style.display = "none";
                cancelBtn.style.display = "none";
                buttonContainer.style.display = "flex";
            }

            // Convert seconds to mm:ss
            function formatTimeNatural(seconds) {
                const hrs = Math.floor(seconds / 3600);
                const remainderAfterHours = seconds % 3600;
                const mins = Math.floor(remainderAfterHours / 60);
                const secs = remainderAfterHours % 60;

                if (hrs > 0) {
                    // Hours present
                    if (mins > 0 && secs > 0) {
                        return `${hrs} h ${mins} m ${secs} s`;
                    } else if (mins > 0) {
                        return `${hrs} h ${mins} m`;
                    } else if (secs > 0) {
                        return `${hrs} h ${secs} s`;
                    } else {
                        return `${hrs} h`;
                    }
                } else if (mins > 0) {
                    // Only minutes and maybe seconds
                    if (secs > 0) {
                        return `${mins} min ${secs} s`;
                    } else {
                        return `${mins} min`;
                    }
                } else {
                    // Only seconds
                    return `${secs} s`;
                }
            }

            // Convert seconds to mm:ss
            function formatTime(seconds) {
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                return `${m}:${s.toString().padStart(2, '0')}`;
            }

            // Initialize
            loadCustomTimers();
        </script>
    </body>
</html>
